<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Змейка</title>
  <style>
    body { background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    canvas { background: #fff; border: 2px solid #333; box-shadow: 0 8px 32px #0008; border-radius: 18px; }
    #score {
      color: #fff;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2rem;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #000a;
      background: rgba(34,34,34,0.35); /* было 0.7, стало 0.35 */
      padding: 8px 32px;
      border-radius: 16px;
      border: 1.5px solid #4caf50;
      box-shadow: 0 2px 8px #0004;
    }
    #gameover {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(34,34,34,0.65); /* было 0.95, стало 0.65 */
      color: #fff;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      font-size: 2.2rem;
      padding: 32px 48px;
      border-radius: 24px;
      box-shadow: 0 8px 32px #000a;
      text-align: center;
      z-index: 10;
      border: 2px solid #f44336;
      animation: fadeIn 0.7s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    #mobile-controls {
      position: fixed;
      left: 0; right: 0; bottom: 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 30;
      pointer-events: none;
      user-select: none;
    }
    #mobile-controls .arrow {
      pointer-events: auto;
      width: 92px; height: 92px;
      margin: 0 14px 18px 14px;
      font-size: 3.2rem;
      background: linear-gradient(145deg, #fffde7 60%, #b2dfdb 100%);
      color: #222;
      border: 2.5px solid #4caf50;
      border-radius: 22px;
      box-shadow: 0 2px 16px #0002;
      outline: none;
      transition: background 0.2s, box-shadow 0.2s;
      font-family: inherit;
      font-weight: bold;
      cursor: pointer;
      opacity: 0.94;
      touch-action: manipulation;
    }
    #mobile-controls .arrow:active {
      background: #b2dfdb;
      box-shadow: 0 1px 4px #0004;
    }
    /* Стрелки всегда видимы */
    /* canvas адаптивен только на мобильных */
    @media (max-width: 700px) {
      canvas { width: 98vw !important; height: 98vw !important; max-width: 98vw; max-height: 60vw; }
    }
  </style>
</head>
<body>
  <div id="score">Счёт: 0</div>
  <canvas id="game" width="480" height="480"></canvas>
  <div id="gameover"></div>
  <!-- Мобильные стрелки управления -->
  <div id="mobile-controls">
    <button class="arrow" id="arrow-up" aria-label="Вверх">▲</button>
    <div style="display:flex;justify-content:center;gap:12px;">
      <button class="arrow" id="arrow-left" aria-label="Влево">◀</button>
      <button class="arrow" id="arrow-down" aria-label="Вниз">▼</button>
      <button class="arrow" id="arrow-right" aria-label="Вправо">▶</button>
    </div>
  </div>
  <button id="music-btn" style="position:absolute;top:20px;right:32px;z-index:20;padding:8px 18px;font-size:1rem;background:#b2dfdb;color:#222;border:none;border-radius:10px;box-shadow:0 2px 8px #0002;cursor:pointer;">Музыка: Вкл</button>
  <select id="music-select" style="position:absolute;top:20px;right:150px;z-index:20;padding:7px 12px;font-size:1rem;background:#fffde7;color:#222;border:none;border-radius:10px;box-shadow:0 2px 8px #0002;cursor:pointer;"
    onkeydown="event.preventDefault();"
  >
    <option value="Spring-Flowers(chosic.com).mp3">Spring Flowers</option>
    <option value="ANNA_ASTI_-_Carica_76368874.mp3">АННА АСТИ - Царица</option>
  </select>
  <audio id="bg-music" src="Spring-Flowers(chosic.com).mp3" loop preload="auto"></audio>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const box = 20;
    const fieldSize = 720;
    canvas.width = fieldSize;
    canvas.height = fieldSize;
    let snake = [{x: 14*box, y: 15*box}];
    let direction = null;
    // --- Типы фруктов ---
    const fruitTypes = [
      {
        name: 'cherry',
        color: '#ff1744',
        draw: function(x, y, box) {
          ctx.save();
          ctx.shadowColor = '#c62828';
          ctx.shadowBlur = 16;
          // Две вишенки
          ctx.beginPath();
          ctx.arc(x + box/2 - 5, y + box/2 + 2, box/2 - 8, 0, 2 * Math.PI);
          ctx.arc(x + box/2 + 5, y + box/2 + 2, box/2 - 8, 0, 2 * Math.PI);
          ctx.fillStyle = '#ff1744';
          ctx.fill();
          ctx.lineWidth = 2.2;
          ctx.strokeStyle = '#b71c1c';
          ctx.stroke();
          // Блики
          ctx.globalAlpha = 0.25;
          ctx.beginPath(); ctx.arc(x + box/2 - 7, y + box/2 - 1, 2, 0, 2 * Math.PI); ctx.fillStyle = '#fff'; ctx.fill();
          ctx.beginPath(); ctx.arc(x + box/2 + 3, y + box/2 - 1, 2, 0, 2 * Math.PI); ctx.fillStyle = '#fff'; ctx.fill(); ctx.globalAlpha = 1;
          // Черенки
          ctx.save(); ctx.shadowBlur = 0;
          ctx.strokeStyle = '#388e3c'; ctx.lineWidth = 2;
          ctx.beginPath(); ctx.moveTo(x + box/2 - 5, y + box/2 - 2); ctx.lineTo(x + box/2 - 2, y + box/2 - 10); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(x + box/2 + 5, y + box/2 - 2); ctx.lineTo(x + box/2 + 2, y + box/2 - 10); ctx.stroke();
          // Листик
          ctx.beginPath(); ctx.ellipse(x + box/2, y + box/2 - 12, 5, 2.5, -0.3, 0, 2 * Math.PI); ctx.fillStyle = '#00e676'; ctx.fill();
          ctx.restore();
          ctx.restore();
        }
      }
    ];

    let food = getRandomFood();
    function getRandomFood() {
      const type = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
      return {
        x: Math.floor(Math.random() * (fieldSize/box)) * box,
        y: Math.floor(Math.random() * (fieldSize/box)) * box,
        appear: 1,
        type: type
      };
    }
    let score = 0;
    let gameOver = false;

    // --- Звук поедания еды ---
    function playEatSound() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'triangle';
      o.frequency.value = 520;
      g.gain.value = 0.18;
      o.connect(g);
      g.connect(ctx.destination);
      o.start();
      o.frequency.linearRampToValueAtTime(880, ctx.currentTime + 0.08);
      g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.13);
      o.stop(ctx.currentTime + 0.13);
      o.onended = () => ctx.close();
    }
    // --- конец блока звука ---

    // --- Звук game over ---
    function playGameOverSound() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sawtooth';
      o.frequency.setValueAtTime(440, ctx.currentTime);
      o.frequency.linearRampToValueAtTime(180, ctx.currentTime + 0.3);
      g.gain.value = 0.22;
      o.connect(g);
      g.connect(ctx.destination);
      o.start();
      g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.32);
      o.stop(ctx.currentTime + 0.32);
      o.onended = () => ctx.close();
    }
    // --- конец блока звука ---

    // --- Фоновая музыка через <audio> ---
    const musicBtn = document.getElementById('music-btn');
    const bgMusic = document.getElementById('bg-music');
    const musicSelect = document.getElementById('music-select');
    let musicPlaying = false;
    const musicTracks = {
      'Spring-Flowers(chosic.com).mp3': 'Spring Flowers',
      'ANNA_ASTI_-_Carica_76368874.mp3': 'АННА АСТИ - Царица'
    };

    musicBtn.onclick = () => {
      if (musicPlaying) {
        bgMusic.pause();
        musicBtn.textContent = 'Музыка: Выкл';
        musicPlaying = false;
      } else {
        bgMusic.volume = 0.08; // было 0.18, стало 0.08
        bgMusic.play();
        musicBtn.textContent = 'Музыка: Вкл';
        musicPlaying = true;
      }
    };
    musicSelect.onchange = () => {
      const wasPlaying = musicPlaying;
      bgMusic.pause();
      bgMusic.currentTime = 0;
      bgMusic.src = musicSelect.value;
      if (wasPlaying) {
        setTimeout(() => {
          bgMusic.play();
        }, 100);
      }
    };
    // Автостарт музыки (требует взаимодействия пользователя в некоторых браузерах)
    setTimeout(() => { musicBtn.click(); }, 600);
    // --- конец блока фоновой музыки ---

    // Анимированный красивый фон с цветами
    let gradAngle = 0;
    function drawBackground() {
      gradAngle += 0.005;
      const x1 = fieldSize/2 + Math.cos(gradAngle) * fieldSize/2;
      const y1 = fieldSize/2 + Math.sin(gradAngle) * fieldSize/2;
      const x2 = fieldSize/2 - Math.cos(gradAngle) * fieldSize/2;
      const y2 = fieldSize/2 - Math.sin(gradAngle) * fieldSize/2;
      const grad = ctx.createLinearGradient(x1, y1, x2, y2);
      grad.addColorStop(0, '#ffe0f7'); // светло-розовый
      grad.addColorStop(0.5, '#e0fff7'); // мятный
      grad.addColorStop(1, '#e0e7ff'); // нежно-голубой
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, fieldSize, fieldSize);

      // Цветочные элементы (лёгкие, полупрозрачные)
      for (let i = 0; i < 6; i++) {
        const t = gradAngle * (1 + i*0.2);
        const cx = fieldSize/2 + Math.cos(t + i) * (fieldSize/2.5 + 20*Math.sin(t*2+i));
        const cy = fieldSize/2 + Math.sin(t + i) * (fieldSize/2.5 + 20*Math.cos(t*2-i));
        ctx.save();
        ctx.globalAlpha = 0.13 + 0.07*Math.sin(gradAngle*2+i);
        ctx.beginPath();
        for (let p = 0; p < 6; p++) {
          const angle = (Math.PI*2/6)*p;
          const px = cx + Math.cos(angle) * 32;
          const py = cy + Math.sin(angle) * 32;
          ctx.lineTo(px, py);
        }
        ctx.closePath();
        ctx.fillStyle = i%2===0 ? '#ffb6e6' : '#b2f7ef';
        ctx.fill();
        ctx.restore();
      }
    }

    document.addEventListener('keydown', e => {
      if (gameOver) return;
      if (e.key === 'ArrowLeft' && direction !== 'RIGHT') direction = 'LEFT';
      if (e.key === 'ArrowUp' && direction !== 'DOWN') direction = 'UP';
      if (e.key === 'ArrowRight' && direction !== 'LEFT') direction = 'RIGHT';
      if (e.key === 'ArrowDown' && direction !== 'UP') direction = 'DOWN';
    });

    function drawSnake() {
      for (let i = 0; i < snake.length; i++) {
        ctx.save();
        ctx.shadowColor = '#4caf50';
        ctx.shadowBlur = i === 0 ? 16 : 6;
        ctx.fillStyle = i === 0 ? '#43a047' : '#8bc34a';
        ctx.beginPath();
        ctx.roundRect(snake[i].x + 2, snake[i].y + 2, box - 4, box - 4, 6);
        ctx.fill();
        ctx.restore();
      }
    }

    function drawFood() {
      ctx.save();
      ctx.globalAlpha = food.appear;
      ctx.shadowColor = food.type.color;
      ctx.shadowBlur = 16;
      food.type.draw(food.x, food.y, box);
      ctx.restore();
      if (food.appear < 1) food.appear += 0.1;
    }

    // --- Победная анимация ---
    let winAnimationActive = false;
    let winParticles = [];
    function startWinAnimation() {
      winAnimationActive = true;
      winParticles = [];
      for (let i = 0; i < 32; i++) {
        const angle = (Math.PI * 2 / 32) * i;
        winParticles.push({
          x: fieldSize/2,
          y: fieldSize/2,
          vx: Math.cos(angle) * (2.5 + Math.random()*2.5),
          vy: Math.sin(angle) * (2.5 + Math.random()*2.5),
          r: 18 + Math.random()*8,
          type: Math.random() > 0.5 ? 'rose' : 'heart',
          alpha: 1,
          rot: Math.random()*Math.PI*2
        });
      }
    }
    function drawRose(ctx, r) {
      ctx.save();
      ctx.scale(r/24, r/24);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      for (let i = 0; i < 6; i++) {
        ctx.bezierCurveTo(8, -8, 16, 8, 0, 16);
        ctx.rotate(Math.PI/3);
      }
      ctx.closePath();
      ctx.fillStyle = '#e53970';
      ctx.shadowColor = '#c2185b';
      ctx.shadowBlur = 8;
      ctx.fill();
      // центр
      ctx.beginPath();
      ctx.arc(0, 0, 6, 0, 2*Math.PI);
      ctx.fillStyle = '#ad1457';
      ctx.shadowBlur = 0;
      ctx.fill();
      ctx.restore();
    }
    function drawWinAnimation() {
      if (!winAnimationActive) return;
      for (const p of winParticles) {
        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        if (p.type === 'heart') {
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.bezierCurveTo(-p.r/2, -p.r/2, -p.r, p.r/3, 0, p.r);
          ctx.bezierCurveTo(p.r, p.r/3, p.r/2, -p.r/2, 0, 0);
          ctx.fillStyle = '#ff4081';
          ctx.shadowColor = '#ff1744';
          ctx.shadowBlur = 8;
          ctx.fill();
        } else if (p.type === 'rose') {
          drawRose(ctx, p.r);
        }
        ctx.restore();
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.98;
        p.vy *= 0.98;
        p.alpha -= 0.012;
        p.rot += 0.03;
      }
      winParticles = winParticles.filter(p => p.alpha > 0.05);
      if (winParticles.length === 0) winAnimationActive = false;
    }
    // --- конец блока победной анимации ---

    function draw() {
      drawBackground();
      drawSnake();
      drawFood();
      drawWinAnimation();

      let headX = snake[0].x;
      let headY = snake[0].y;

      if (direction === 'LEFT') headX -= box;
      if (direction === 'UP') headY -= box;
      if (direction === 'RIGHT') headX += box;
      if (direction === 'DOWN') headY += box;

      // Проверка на поедание еды
      if (headX === food.x && headY === food.y) {
        score++;
        document.getElementById('score').textContent = 'Счёт: ' + score;
        food = getRandomFood();
        food.appear = 0;
        playEatSound();
        if (score === 5) {
          setTimeout(() => {
            alert('Оля ты милаха, у тебя шикарная улыбка');
            speakOlya();
          }, 100);
        }
        if (score === 10) {
          setTimeout(() => {
            alert('да что ты =)');
            speakDaChtoTy();
          }, 100);
        }
        if (score === 15) {
          setTimeout(() => {
            alert('У тебя классная фигура и с тобой приятно пообщаться)');
            speakFigura();
          }, 100);
        }
        if (score === 20) {
          setTimeout(() => {
            alert('да что=) Ты выиграла эту жизнь!!!');
            speakWinLife();
          }, 100);
        }
        if (score === 25) {
          clearInterval(game);
          gameOver = true;
          setTimeout(() => {
            alert('Оля ты победила');
            speakOlyaWin();
            showGameOverCustom('Оля ты победила!<br>Ты набрала 25 очков!');
          }, 100);
          return;
        }
      } else {
        snake.pop();
      }

      // Новая голова
      const newHead = {x: headX, y: headY};

      // Проверка на столкновение
      if (
        headX < 0 || headX >= fieldSize || headY < 0 || headY >= fieldSize ||
        snake.some(segment => segment.x === headX && segment.y === headY)
      ) {
        clearInterval(game);
        gameOver = true;
        playGameOverSound();
        showGameOver();
        return;
      }

      snake.unshift(newHead);
    }

    function showGameOver() {
      const over = document.getElementById('gameover');
      over.innerHTML = `Игра окончена!<br>Ваш счёт: <b>${score}</b><br><button id="restart" style="margin-top:18px;padding:10px 28px;font-size:1.1rem;background:#4caf50;color:#fff;border:none;border-radius:8px;cursor:pointer;">Заново</button>`;
      over.style.display = 'block';
      document.getElementById('restart').onclick = () => location.reload();
      bgMusic.pause();
      musicBtn.textContent = 'Музыка: Выкл';
      musicPlaying = false;
    }

    function speakOlya() {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance('Оля, ты милаха, у тебя шикарная улыбка');
      utter.lang = 'ru-RU';
      // Найти приятный мужской голос
      const voices = window.speechSynthesis.getVoices();
      const maleRu = voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('male'))
        || voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('муж'))
        || voices.find(v => v.lang === 'ru-RU' && v.gender === 'male')
        || voices.find(v => v.lang === 'ru-RU');
      if (maleRu) utter.voice = maleRu;
      utter.rate = 0.95;
      utter.pitch = 0.8;
      window.speechSynthesis.speak(utter);
    }

    // --- добавлено: озвучка для 10 очков ---
    function speakDaChtoTy() {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance('да что ты');
      utter.lang = 'ru-RU';
      // Найти приятный мужской голос
      const voices = window.speechSynthesis.getVoices();
      const maleRu = voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('male'))
        || voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('муж'))
        || voices.find(v => v.lang === 'ru-RU' && v.gender === 'male')
        || voices.find(v => v.lang === 'ru-RU');
      if (maleRu) utter.voice = maleRu;
      utter.rate = 1.05;
      utter.pitch = 0.9;
      window.speechSynthesis.speak(utter);
    }
    // --- конец блока озвучки ---
    function speakWinLife() {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance('да что. Ты выиграла эту жизнь!');
      utter.lang = 'ru-RU';
      const voices = window.speechSynthesis.getVoices();
      const maleRu = voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('male'))
        || voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('муж'))
        || voices.find(v => v.lang === 'ru-RU' && v.gender === 'male')
        || voices.find(v => v.lang === 'ru-RU');
      if (maleRu) utter.voice = maleRu;
      utter.rate = 1.0;
      utter.pitch = 0.95;
      window.speechSynthesis.speak(utter);
    }
    function speakFigura() {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance('У тебя классная фигура и с тобой приятно пообщаться');
      utter.lang = 'ru-RU';
      const voices = window.speechSynthesis.getVoices();
      const maleRu = voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('male'))
        || voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('муж'))
        || voices.find(v => v.lang === 'ru-RU' && v.gender === 'male')
        || voices.find(v => v.lang === 'ru-RU');
      if (maleRu) utter.voice = maleRu;
      utter.rate = 1.0;
      utter.pitch = 0.9;
      window.speechSynthesis.speak(utter);
    }
    function speakOlyaWin() {
      if (!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance('Оля ты победила');
      utter.lang = 'ru-RU';
      const voices = window.speechSynthesis.getVoices();
      const maleRu = voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('male'))
        || voices.find(v => v.lang === 'ru-RU' && v.name.toLowerCase().includes('муж'))
        || voices.find(v => v.lang === 'ru-RU' && v.gender === 'male')
        || voices.find(v => v.lang === 'ru-RU');
      if (maleRu) utter.voice = maleRu;
      utter.rate = 1.0;
      utter.pitch = 1.0;
      window.speechSynthesis.speak(utter);
    }
    function showGameOverCustom(msg) {
      const over = document.getElementById('gameover');
      over.innerHTML = `${msg}<br><button id="restart" style="margin-top:18px;padding:10px 28px;font-size:1.1rem;background:#4caf50;color:#fff;border:none;border-radius:8px;cursor:pointer;">Заново</button>`;
      over.style.display = 'block';
      document.getElementById('restart').onclick = () => location.reload();
      bgMusic.pause();
      musicBtn.textContent = 'Музыка: Выкл';
      musicPlaying = false;
      startWinAnimation();
    }

    // --- Мобильные стрелки ---
    function handleArrow(dir) {
      if (gameOver) return;
      if (dir === 'LEFT' && direction !== 'RIGHT') direction = 'LEFT';
      if (dir === 'UP' && direction !== 'DOWN') direction = 'UP';
      if (dir === 'RIGHT' && direction !== 'LEFT') direction = 'RIGHT';
      if (dir === 'DOWN' && direction !== 'UP') direction = 'DOWN';
    }
    document.getElementById('arrow-up').addEventListener('touchstart', e => { e.preventDefault(); handleArrow('UP'); });
    document.getElementById('arrow-down').addEventListener('touchstart', e => { e.preventDefault(); handleArrow('DOWN'); });
    document.getElementById('arrow-left').addEventListener('touchstart', e => { e.preventDefault(); handleArrow('LEFT'); });
    document.getElementById('arrow-right').addEventListener('touchstart', e => { e.preventDefault(); handleArrow('RIGHT'); });
    // Для кликов мышкой (на эмуляторах и ПК)
    document.getElementById('arrow-up').addEventListener('click', () => handleArrow('UP'));
    document.getElementById('arrow-down').addEventListener('click', () => handleArrow('DOWN'));
    document.getElementById('arrow-left').addEventListener('click', () => handleArrow('LEFT'));
    document.getElementById('arrow-right').addEventListener('click', () => handleArrow('RIGHT'));
    // --- конец блока мобильных стрелок ---

    // Полифил для roundRect (старые браузеры)
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        this.beginPath();
        this.moveTo(x + r, y);
        this.lineTo(x + w - r, y);
        this.quadraticCurveTo(x + w, y, x + w, y + r);
        this.lineTo(x + w, y + h - r);
        this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
        this.lineTo(x + r, y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - r);
        this.lineTo(x, y + r);
        this.quadraticCurveTo(x, y, x + r, y);
        this.closePath();
      };
    }

    let game = setInterval(draw, 130);
  </script>
</body>
</html>